require(["arcplanobjects/arcplanobjectsfactory","components/containerbuilder/containerbuilder","logger"],function(a,b,c){describe("arcplanobjects createNewArcplanObjects",function(){it("should call createArcplanObject of the registered builder for each element in docObjects",function(){var b=a.createInstance(),c=$("<div></div>"),d={ObjID:"1",ObjectData:{}},e={ObjID:"2",ObjectData:{}},f={Elements:[{component_A:d},{component_B:e}]},g={createArcplanObject:jasmine.createSpy()},h={createArcplanObject:jasmine.createSpy()};b.registerArcplanObjectBuilder("component_A",g),b.registerArcplanObjectBuilder("component_B",h),b.createNewArcplanObjects("docname",c,f),expect(g.createArcplanObject).toHaveBeenCalledWith("docname",d),expect(h.createArcplanObject).toHaveBeenCalledWith("docname",e)}),it("should not try to create an arcplanObject for elements in docObjects with no ObjID or no object",function(){var c=a.createInstance(),d=$("<div></div>"),e={ObjectData:{}},f={Elements:[{someComponent:e},{someComponent:undefined}]};spyOn(b,"createContainer"),c.createNewArcplanObjects("docname",d,f),expect(b.createContainer).not.toHaveBeenCalled()}),it("should append a container containing a component to the document for each element",function(){var b=a.createInstance(),c=$("<div></div>"),d={ObjID:"1",ObjectData:{},BaseProperties:{Position:{XPos:"111",YPos:"112"},Width:{Value:"113"},Height:{Value:"114"}}},e={ObjID:"2",ObjectData:{},BaseProperties:{Position:{XPos:"211",YPos:"212"},Width:{Value:"213"},Height:{Value:"214"}}},f={Elements:[{fakeComponent:d},{fakeComponent:e}]},g={insertIntoContainer:function(a){a.html("fakeComponent")}},h={createArcplanObject:function(){return g}},i,j;b.registerArcplanObjectBuilder("fakeComponent",h),expect(c.children().length).toEqual(0),b.createNewArcplanObjects("docname",c,f),expect(c.children().length).toEqual(2),i=c.children().first(),j=c.children().last(),expect(i.css("left")).toEqual("111px"),expect(i.css("top")).toEqual("112px"),expect(i.css("width")).toEqual("113px"),expect(i.css("height")).toEqual("114px"),expect(i.text()).toEqual("fakeComponent"),expect(j.css("left")).toEqual("211px"),expect(j.css("top")).toEqual("212px"),expect(j.css("width")).toEqual("213px"),expect(j.css("height")).toEqual("214px"),expect(j.text()).toEqual("fakeComponent")}),it("should not append a container to the document when no builder is registered for an element in docObjects",function(){var b=a.createInstance(),c=$("<div></div>"),d={ObjID:"1",ObjectData:{}},e={Elements:[{component_C:d}]};expect(c.children().length).toEqual(0),b.createNewArcplanObjects("docname",c,e),expect(c.children().length).toEqual(0)})}),describe("arcplanobjects isArcplanObjectAlreadyCreated",function(){it("should return true for arcplanObjects which have been created, otherwise false",function(){var b=a.createInstance(),c=$("<div></div>"),d={ObjID:"1",ObjectData:{},BaseProperties:{Position:{XPos:"1",YPos:"2"},Width:{Value:"3"},Height:{Value:"4"}}},e={Elements:[{anotherFake:d}]},f={createArcplanObject:function(){return{insertIntoContainer:function(){}}}};b.registerArcplanObjectBuilder("anotherFake",f),expect(b.isArcplanObjectAlreadyCreated("testDocName","1")).toEqual(!1),b.createNewArcplanObjects("testDocName",c,e),expect(b.isArcplanObjectAlreadyCreated("testDocName","1")).toEqual(!0),expect(b.isArcplanObjectAlreadyCreated("testDocName","2")).toEqual(!1),expect(b.isArcplanObjectAlreadyCreated("testDocName2","1")).toEqual(!1)})}),describe("updateArcplanObjects",function(){it("should call the update function of all created arcplanObjects which are in the passed list of updated objects",function(){var b=a.createInstance(),c=$("<div></div>"),d={ObjID:"1",BaseProperties:{Position:{XPos:"1",YPos:"2"},Width:{Value:"3"},Height:{Value:"4"}}},e={ObjID:"1",Worksheet:"Document.apd"},f={Elements:[{updateTestComponent:d}]},g={Elements:[{updateTestComponent:e}]},h=jasmine.createSpy(),i={createArcplanObject:function(){return{insertIntoContainer:function(){},update:h}}};b.registerArcplanObjectBuilder("updateTestComponent",i),b.createNewArcplanObjects("Document",c,f),b.updateArcplanObjects(g),expect(h).toHaveBeenCalledWith(e)}),it("should ignore (not try to call the update function) for elements with no ObjID or no object",function(){var b=a.createInstance(),c=$("<div></div>"),d={Worksheet:"updateTestDocument.apd"},e={Elements:[{megaComponent:d},{megaComponent:undefined}]},f=!1;try{b.updateArcplanObjects(e)}catch(g){f=!0}expect(f).toEqual(!1)}),it("should log a message and ignore (not try to call the update function) for objects that were not created",function(){var b=a.createInstance(),d=$("<div></div>"),e={ObjID:"1",Worksheet:"AnUpdateTestDocument.apd"},f={Elements:[{updateTestComponent:e}]},g=!1;spyOn(c,"info");try{b.updateArcplanObjects(f)}catch(h){g=!0}expect(g).toEqual(!1),expect(c.info).toHaveBeenCalled()})})})