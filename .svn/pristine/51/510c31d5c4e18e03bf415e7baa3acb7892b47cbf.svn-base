require(["events/eventcallbacks","events/eventsetterfactory","view","properties","stylesheethandler","logger","objectpropertyapplier","htmleditor","tablehtmlgenerator","textinput","arcplanobjects/arcplanobjectsfactory"],function(a,b,c,d,e,f,g,h,i,j,k){function l(){return ARCTEST.objectdatabuilder().make2x2DataForTable()}describe("eventsetter Tests",function(){var i={fontFamily:"Arial",fontSize:"10pt",fontStyle:"normal",textDecoration:"none"};beforeEach(function(){var d=k.createInstance();$('<div id="arcContainer"></div>').appendTo("body"),$("body").css("margin","0px"),$("#arcContainer").css("position","absolute").css("top","0px").css("left","0px").css("width","100%").css("height","100%"),this.docContainer=$('<div id="Cont0_test"></div>').appendTo("#arcContainer"),this.requestProcessor={buildObjectPictRequest:jasmine.createSpy("buildObjectPictRequest").andReturn("about:blank"),downloadPictToBrowserCache:jasmine.createSpy("downloadPictToBrowserCache").andCallFake(function(a,b){b()}),setView:jasmine.createSpy("setView"),setLastMouseDownPos:jasmine.createSpy("setLastMouseDownPos")},this.sessionContext={onDocumentLoaded:jasmine.createSpy("onDocumentLoaded"),onWaitingStateChanged:jasmine.createSpy("onWaitingStateChanged"),getFixedWindowSizeForWidget:jasmine.createSpy("getFixedWindowSizeForWidget")},this.view=c(this.requestProcessor,this.sessionContext,d),this.eventSetter=b.createInstance(),spyOn(a,"onChange"),spyOn(a,"onClick"),spyOn(a,"onMenuClick"),spyOn(a,"onHierClick"),spyOn(a,"onInput"),spyOn(f,"log"),spyOn(f,"warn")}),afterEach(function(){this.eventSetter=null,this.view=null,this.sessionContext=null,this.requestProcessor=null,$("#arcContainer").remove(),d.resetAllProperties(),e.removeClassesForDocument(".test")}),it("should set the click event for menus",function(){var b;this.view.transferObjects(this.docContainer,{Elements:[ARCTEST.objectData().menu1]},"test"),b=$("#Cont1_test").trigger("mousedown"),this.eventSetter.setTypeSpecificEvents(b),b.trigger("click"),expect(a.onMenuClick).toHaveBeenCalledWith(jasmine.any(Object)),expect(a.onClick).not.toHaveBeenCalled()}),it("should set the click-event for RadioGroups in setTypeSpecificEvents",function(){var b,c=ARCTEST.objectData().radioButtonVertical13;this.view.transferObjects(this.docContainer,{Elements:[c]},"test"),$("#Cont13_test").find("input").trigger("click"),expect(a.onChange).toHaveBeenCalledWith(jasmine.any(Object)),b=a.onChange.mostRecentCall.args[0].data,expect(b.id).toEqual("Cont13_test")}),it("should add the arcClickable class to Radios in setTypeSpecificEvents",function(){var a=ARCTEST.objectData().radioButtonVertical13;this.view.transferObjects(this.docContainer,{Elements:[a]},"test"),expect($("#Cont13_test").find("input").hasClass("arcClickable")).toBe(!0)}),it("should add the arcClickable class to Switches in setTypeSpecificEvents",function(){var a=ARCTEST.objectData().switchObj23;this.view.transferObjects(this.docContainer,{Elements:[a]},"test"),expect($("#Cont23_test").find("button").hasClass("arcClickable")).toEqual(!0)}),it("should add the arcClickable class to VerticalHierarchies in setTypeSpecificEvents",function(){var a=ARCTEST.objectData().verticalHierBoxFormat30;this.view.transferObjects(this.docContainer,{Elements:[a]},"test"),expect($("#Cont30_test").hasClass("arcClickable")).toEqual(!1)}),it("should add the arcClickable class to HorizontalHierarchies in setTypeSpecificEvents",function(){var a=ARCTEST.objectData().horizontalHierBoxFormat31;this.view.transferObjects(this.docContainer,{Elements:[a]},"test"),expect($("#Cont31_test").hasClass("arcClickable")).toEqual(!1)}),it("should set the click event",function(){var b,c=ARCTEST.objectData().row10;c.Row.ObjectProperties.Events={Elements:[{Event:{Type:"OnClick"}}]},this.view.transferObjects(this.docContainer,{Elements:[c]},"test"),$("#Cont10_test").trigger("click"),expect(a.onClick).toHaveBeenCalledWith(jasmine.any(Object)),b=a.onClick.mostRecentCall.args[0].data,expect(b.id).toEqual("Cont10_test"),expect($("#Cont10_test").hasClass("arcClickable")).toEqual(!0)}),it("should set the click event in a VerticalHierarchie",function(){var b=ARCTEST.objectData().verticalHierBoxFormat30;this.view.transferObjects(this.docContainer,{Elements:[b]},"test"),$("#Cont30_test").trigger("click"),expect(a.onHierClick).toHaveBeenCalledWith(jasmine.any(Object)),expect(a.onClick).not.toHaveBeenCalled()}),it("should not set the click event for RadioGroups in setEvents",function(){var b=ARCTEST.objectData().radioButtonVertical13;b.RadioGroup.ObjectProperties.Events={Elements:[{Event:{Type:"OnClick"}}]},this.view.transferObjects(this.docContainer,{Elements:[b]},"test"),$("#Cont13_test").trigger("click"),expect(a.onClick).not.toHaveBeenCalled()}),it("should ignore the switch event in setEvents",function(){var a=ARCTEST.objectData().field7;a.Field.ObjectProperties.Events={Elements:[{Event:{Type:"OnSwitch"}}]},this.view.transferObjects(this.docContainer,{Elements:[a]},"test"),expect(f.warn).not.toHaveBeenCalled()}),it("should ignore the OnComment event in setEvents",function(){var a=ARCTEST.objectData().field7;a.Field.ObjectProperties.Events={Elements:[{Event:{Type:"OnComment"}}]},this.view.transferObjects(this.docContainer,{Elements:[a]},"test"),expect(f.warn).not.toHaveBeenCalled()}),it("should set the input event for a checkbox",function(){var b,c=ARCTEST.objectData().checkBox4,d={Elements:[c]};c.CheckboxGroup.ObjectProperties.Events={Elements:[{Event:{Type:"OnInput"}}]},this.view.transferObjects(this.docContainer,d,"test"),g.updateReferences(this.docContainer,d,"test",this.requestProcessor),$("#Cont4_test").find("input").trigger("click"),expect(a.onInput).toHaveBeenCalledWith(jasmine.any(Object)),b=a.onInput.mostRecentCall.args[0].data,expect(b.id).toEqual("Cont4_test"),expect($("#Cont4_test").hasClass("arcClickable")).toEqual(!1)}),it("should trigger the click event on a hierarchy node",function(){var b,c=ARCTEST.objectData().verticalHierTreeFormat28;this.view.transferObjects(this.docContainer,{Elements:[c]},"test"),$("#Cont28_test").find("input:first").trigger("click"),expect(a.onHierClick).toHaveBeenCalledWith(jasmine.any(Object)),b=a.onHierClick.mostRecentCall.args[0].data,expect(b.id).toEqual("Cont28_test")}),it("should ignore the input event for objects other than checkbox",function(){var b=ARCTEST.objectData().field7;b.Field.ObjectProperties.Events={Elements:[{Event:{Type:"OnInput"}}]},this.view.transferObjects(this.docContainer,{Elements:[b]},"test"),$("#Cont7_test").trigger("click"),expect(a.onInput).not.toHaveBeenCalled()}),it("should ignore the OnCheck event in setEvents",function(){var a=ARCTEST.objectData().switchObj23;a.Switch.ObjectProperties.Events={Elements:[{Event:{Type:"OnCheck"}}]},this.view.transferObjects(this.docContainer,{Elements:[a]},"test"),expect(f.warn).not.toHaveBeenCalled()}),it("should not set multiple events after multiple updates",function(){var b=ARCTEST.objectData().switchObj23;b.Switch.ObjectProperties.Events={Elements:[{Event:{Type:"OnClick"}}]},this.view.transferObjects(this.docContainer,{Elements:[b]},"test"),this.view.transferObjects(this.docContainer,{Elements:[b]},"test"),$("#Cont23_test").trigger("click"),expect(a.onClick.callCount).toEqual(1)}),it("should not set multiple events after multiple updates",function(){var b=ARCTEST.objectData().checkBox4;b.CheckboxGroup.ObjectProperties.Events={Elements:[{Event:{Type:"OnInput"}}]},this.view.transferObjects(this.docContainer,{Elements:[b]},"test"),this.view.transferObjects(this.docContainer,{Elements:[b]},"test"),$("#Cont4_test").trigger("click"),expect(a.onInput.callCount).toEqual(1)}),it("should init correct Html Editor",function(){var a=ARCTEST.objectData().text12,b,c,e,f,g,i;i={createExtendedEventDataForInput:function(){return{target:b,id:"Cont12_test"}}},this.view.transferObjects(this.docContainer,{Elements:[a]},"test"),b=$("#Cont12_test"),d.setFormattedTextInput(b,!0),g={fontFamily:"Arial",fontSize:"10pt",fontStyle:"normal",textDecoration:"none"},d.setFont(b,g),this.eventSetter.setEventForInput(b,12,i),h.initializeEditorForNotInitialHtmlText=function(a,b,c){e=c},b.trigger("click"),f='<span style="font-family: Arial; font-size: 10pt; font-style: normal; text-decoration: none;"><span>Das ist ein Textfeld</span><br></span>',expect(e).toEqual(f)}),it("should init HTML Editor for field object with VHTML type",function(){var a,b,c=!1,e={createExtendedEventDataForInput:function(){return{target:b,id:"Cont21_test"}}};a={Field:{ObjID:"21",Worksheet:"test.apd",ObjectData:{NumCols:"1",NumRows:"1",Rows:{Elements:[{Row:{Elements:[{Cell:{Type:"39",HtmlSource:'<span style="font-family:arial; font-size:9pt"><b>Hallo</b></span>',Justification:"3"}}]}}]}}}},this.view.transferObjects(this.docContainer,{Elements:[a]},"test"),b=$("#Cont21_test"),d.setObjType(b,"Field"),d.setFont(b,i),d.setVHTMLField(b,!0),d.setHtmlSource(b,'<span style="font-family:arial; font-size:9pt"><b>Hallo</b></span>'),h.initializeEditorForVHTMLField=function(a,b,d){c=!0,expect(d).toContain('<span style="font-family:arial; font-size:9pt"><b>Hallo</b></span>')},this.eventSetter.setEventForInput(b,12,e),expect(c).toBe(!0)}),it("should call onInput and removeForm on executePendingBlurEvent if PendingBlurEvent exist",function(){var b,c={data:{}};a.onInput=jasmine.createSpy("onInput"),spyOn(j,"removeForm"),this.eventSetter.setPendingBlurEvent(c),b=this.eventSetter.executePendingBlurEvent(),expect(a.onInput).toHaveBeenCalled(),expect(j.removeForm).toHaveBeenCalled(),expect(b).toBe(!0),b=this.eventSetter.executePendingBlurEvent(),expect(b).toBe(!1)}),it("should not call onInput on executePendingBlurEvent if PendingBlurEvent does not exist",function(){var b;a.onInput=jasmine.createSpy("onInput"),b=this.eventSetter.executePendingBlurEvent(),expect(a.onInput).not.toHaveBeenCalled(),expect(b).toBe(!1)}),it("should execute pendingEvent if PendingEvent exist",function(){var b={data:{}};a.onClick=jasmine.createSpy("onClick"),this.eventSetter.setPendingEvent({callback:a.onClick,event:b}),this.eventSetter.executePendingEvent(),expect(a.onClick).toHaveBeenCalled()}),it("should not execute pendingEvent if PendingEvent does not exist",function(){a.onClick=jasmine.createSpy("onClick"),this.eventSetter.setPendingEvent(),expect(a.onClick).not.toHaveBeenCalled()})}),describe("eventsetter on table objects",function(){beforeEach(function(){$('<div id="arcContainer"></div>').appendTo("body"),$("body").css("margin","0px"),this.docContainer=$('<div id="Cont0_test"></div>').appendTo("#arcContainer"),this.obj=$('<div id="testObj"></div>').appendTo(this.docContainer),this.borderProp={top:!0,left:!1,right:!1,bottom:!1,type:"1Point",color:"#10AA10"},this.font={fontFamily:"Arial",fontSize:"10pt",fontStyle:"normal",fontWeight:"normal",textDecoration:"none"},d.setFont(this.obj,this.font),d.setBorder(this.obj,this.borderProp),d.setXPos(this.obj,111),d.setYPos(this.obj,42),d.setWidth(this.obj,200),d.setHeight(this.obj,100),d.setObjType(this.obj,"Table"),d.setVisible(this.obj,!0),d.setActive(this.obj,!0),i.generateTableStub(this.obj),this.requestProcessor={buildObjectPictRequest:jasmine.createSpy("buildObjectPictRequest").andReturn("about:blank"),downloadPictToBrowserCache:jasmine.createSpy("downloadPictToBrowserCache").andCallFake(function(a,b){b()}),setView:jasmine.createSpy("setView"),setLastMouseDownPos:jasmine.createSpy("setLastMouseDownPos")},this.eventSetter=b.createInstance()}),afterEach(function(){this.eventSetter=null,$("#arcContainer").remove(),d.resetAllProperties()}),it("should register keypress events for the object",function(){var b=$.Event("keypress");b.keyCode=65,spyOn(a,"onTableKeyPress"),spyOn(a,"onTableKeyDown"),this.eventSetter.setTypeSpecificEvents(this.obj),this.obj.children(":first").trigger(b),expect(a.onTableKeyPress).toHaveBeenCalled(),expect(a.onTableKeyDown).not.toHaveBeenCalled()}),it("should register keydown events for the object",function(){var b=$.Event("keydown");b.keyCode=65,spyOn(a,"onTableKeyPress"),spyOn(a,"onTableKeyDown"),this.eventSetter.setTypeSpecificEvents(this.obj),this.obj.children(":first").trigger(b),expect(a.onTableKeyPress).not.toHaveBeenCalled(),expect(a.onTableKeyDown).toHaveBeenCalled()})})})