define("events/eventcallbacks",["events/eventid","logger","ui","stringtools","nodetypes","properties","layoutmanagement","popuphandler","popupkeyeventhandler","browserfeatures","tablekeyboardhandler","keycodes"],function(a,b,c,d,e,f,g,h,i,j,k,l){function q(a,b){return p.executePendingBlurEvent()?(p.setPendingEvent({callback:b,event:a}),!0):!1}function r(a){var b={docName:undefined,objID:undefined,ref:a.data.ref};return a.data.ref&&(b.docName=f.getDocName(a.data.ref),b.objID=f.getID(a.data.ref)),b}function s(a){switch(a.type){case"checkbox":return a.parentNode&&(a.parentNode.tagName==="LI"||$(a).parent().hasClass("arcLabelContainer"))?c.getNodeInfo(a).row:a.checked?"1":"0";case"text":case"textarea":case"password":return a.value;default:return""}}function t(a,b){var c;b!==undefined&&a!==undefined&&(a.children().length>0?(c=a.find("input:first"),c.length>0?c.attr("value",b):a.children().first().text(b)):a.text(b))}function u(a){var b;return a&&(b=a.srcElement,b||(b=a.target)),b}function v(a,b,c,d){var e,f;if(b&&typeof b.tagName=="string"&&b.tagName.toLowerCase()==="g")for(e=0;e<b.childNodes.length;e+=1)f=b.childNodes.item(e),v(a,f,c,d);else b&&b.id!==c&&typeof b.tagName=="string"&&b.tagName.toLowerCase()!=="effect"&&b.style&&!a.test(b.id)&&b.getAttribute("pointer-events")!=="none"&&(b.style.opacity=d)}function w(a,b,c){if(a){var d=a.getElementById("content"),e,f,g=b,h,i;if(!d)return;i=new RegExp("^[0-9]{3}(_[0-9]{3}_[0-9]{3}_)[0-9]{3}.*"),g=i.exec(g),h=new RegExp("^[0-9]{3}"+g[1]+"[0-9]{3}.*");for(e=0;e<d.childNodes.length;e+=1)f=d.childNodes.item(e),v(h,f,b,c)}}function x(a){if(a.hasClass("arcTdInnerDiv")){while(!a.is("td")&&!a.is("body")&&a.length>0)a=a.parent();if(a.is("body"))return}!a.is(":disabled")&&(!j.mobile||!a.is("input"))&&!a.hasClass("arcHpCbox")&&(a.addClass("arcClicked"),window.setTimeout(function(){$(a).removeClass("arcClicked")},500))}function y(a){var b;return a&&(b=a.split("|").join("||")),b}function z(a,b,c){var d=f.getSelectedCell(a),e=f.getNumRows(a),g=f.getNumCols(a),h=$("td.selected",a);if(d)switch(b){case l.Tab:k.handleTab(a,h,c);break;case l.Enter:k.handleEnter(a,h,c)}}var m={},n=!1,o,p;return m.setRequestProcessor=function(a){o=a,i.setDoSendEventCallback(a.doSendEvent)},m.setEventSetter=function(a){p=a},m.getTarget=function(a){var b=a.target,c;b.nodeType===e.TEXT_NODE&&(b=b.parentNode);if(b.tagName==="IMG"&&a.data.ref){c=f.getObjType(a.data.ref);switch(c){case"Field":case"Column":case"Row":case"Table":case"Menu":case"CheckboxGroup":case"RadioGroup":case"Switch":case"VerticalHierarchie":case"HorizontalHierarchie":case"MenuHierarchie":b=b.parentNode}}return b.tagName==="NOBR"&&(b=b.parentNode),b.tagName==="SPAN"&&b.parentNode.tagName==="BUTTON"&&(b=b.parentNode),b.ownerSVGElement&&(b=b.ownerSVGElement),b},m.getClickPos=function(a,b){var d,e,g,h;switch(a.tagName.toUpperCase()){case"IMG":return b.offsetX===undefined?(g=b.pageX-$(a).offset().left,h=b.pageY-$(a).offset().top):(g=b.offsetX,h=b.offsetY),{x:g,y:h};case"SVG":return g=b.pageX-parseInt(f.getXPos(b.data.ref),10),h=b.pageY-parseInt(f.getYPos(b.data.ref),10),{x:g,y:h};case"DIV":if($(a).hasClass("arcTdInnerDiv")||$(a).hasClass("arcTdInnerDivFixedHeight")){while(a.parentElement&&a.parentElement.tagName!=="TD")a=a.parentElement;if(a.parentElement&&a.parentElement.tagName==="TD")return c.getCellPosition(a.parentElement)}break;case"TD":return c.getCellPosition(a);case"LABEL":case"A":case"INPUT":d=a.parentNode,$(d).hasClass("arcLabelContainer")&&(d=$(d).parent()[0]),e=c.getCellPosition(d);if(e.x!==-1)return e;break;case"LI":e=c.getCellPosition(a);if(e.x!==-1)return e;break;case"BUTTON":return{x:0,y:0}}return{x:-1,y:-1}},m.getValue=function(a,b){var d;switch(a.tagName){case"LABEL":case"A":if(a.parentNode&&a.parentNode.tagName==="LI")return c.getNodeInfo(a).row;break;case"LI":return c.getNodeInfo(a).row;case"SPAN":if(a.parentNode&&(a.parentNode.tagName==="LABEL"||a.parentNode.tagName==="A")&&a.parentNode.parentNode&&a.parentNode.parentNode.tagName==="LI")return c.getNodeInfo(a.parentNode).row;break;case"INPUT":case"TEXTAREA":return s(a);case"BUTTON":return"";case"DIV":if($(a).hasClass("cke_editable_inline"))return d=f.getHTMLEditor(b),d.getData();return;default:return'"null"'}},window.highlight=function(a,b){var c=u(a);w(c.ownerDocument,b,.5)},window.reverthighlight=function(a,b){var c=u(a);w(c.ownerDocument,b,1)},m.clickOnSwitch=function(c){if(q(c,m.clickOnSwitch))return;var d=r(c),e=$("#"+c.data.id),g=m.getTarget(c),h=f.getYSettingValue(e)===1?0:1,i=$(g);x(i),o.setLastMouseDownPos(c),b.log("Event clickOnSwitch for doc: "+d.docName+" and id: "+d.objID),o.doSendEvent(d.docName,d.objID,a.EID_SWITCH,h)},m.onMenuClick=function(a){if(q(a,m.onMenuClick))return;var b=r(a),c=m.getTarget(a),d;a.preventDefault(),a.stopImmediatePropagation(),c&&(d=h.handleMenuPopupEvent(a,$(c)),d&&o.doSendEvent(b.docName,b.objID,d.eventType,d.value))},m.onTableKeyDown=function(a){if(q(a,m.onTableKeyDown))return;var b=r(a),c=m.getTarget(a);c&&a.type==="keydown"&&k.handleKeyPressEvent(a)},m.onTableKeyPress=function(a){if(q(a,m.onTableKeyPress))return;var b=r(a),c=m.getTarget(a),d;c&&a.type==="keypress"&&k.handleKeyPressEvent(a)},m.onHierClick=function(c){var d=r(c),e=m.getTarget(c),g,i=m.getClickPos(e,c),j=m.getValue(e,d.ref),k=a.EID_CLICK,l=!0,n,p,s;if(e){g=$(e),f.getObjType(d.ref)!=="MenuHierarchie"&&x(g);if(g.is("input")&&g.is(":checkbox")&&!g.hasClass("arcHpCbox"))g.is(":checked")?k=a.EID_OPENNODE:k=a.EID_CLOSENODE;else if((g.is("label")||g.is("a")&&g.text()!=="Too much data")&&f.getObjType(c.data.ref)!=="MenuHierarchie")k=a.EID_SELECTNODE,c.preventDefault(),c.stopImmediatePropagation();else if(g.is("a")&&g.text()==="Too much data")l=!1;else if(g.hasClass("arcHierPopup")||g.hasClass("arcHierPopupSelection")||h.isCurrentPopup(c.data.ref)){if(q(c,m.onHierClick))return;n=h.handlePopupEvent(c,g),typeof n=="object"&&(i.x=undefined,i.y=undefined,l=n.sendEvent,j=n.value,k=n.eventType,n.stopPropagation&&(c.preventDefault(),c.stopImmediatePropagation()))}}k===a.EID_CLICK&&(p=c.shiftKey,s=c.ctrlKey),l&&(o.setLastMouseDownPos(c),b.log("clickOnHierNode f端r doc:"+d.docName+" and id: "+d.objID),o.doSendEvent(d.docName,d.objID,k,j,i.y,i.x,undefined,p,s)),h.showPendingPopupPos()},m.onHierMouseDown=function(c){var d=r(c),e=m.getTarget(c),g,h=m.getValue(e,d.ref),i,j,k,l,n;e&&(e.tagName.toUpperCase()==="SPAN"&&(e=$(e).parent()[0]),g=m.getClickPos(e,c),j=e.tagName==="LABEL"||e.tagName==="LI"||e.tagName==="SPAN"||e.tagName==="A"&&e.textContent!=="Too much data",k=f.getObjType(c.data.ref)!=="MenuHierarchie",l=c.offsetX||c.pageX-$(e).offset().left,n=l>3||f.getObjType(c.data.ref)!=="VerticalHierarchie"||e.tagName!=="LI",j&&k&&n&&(c.preventDefault(),o.setLastMouseDownPos(c),b.log("mousedownOnHierNode f端r doc:"+d.docName+" and id: "+d.objID),o.doSendEvent(d.docName,d.objID,a.EID_SELECTNODE,h,g.y,g.x,undefined,c.shiftKey,c.ctrlKey)))},m.onButtonClickCallback=function(c,d,e,f){var g="",h=0,i=0,j;o.hasPendingUserinformation()||(b.log("button click f端r doc:"+c+" and id: "+d),o.doSendEvent(c,d,a.EID_CLICK,g,h,i,j,e,f))},m.onClick=function(c){if(q(c,m.onClick))return;var d=r(c),e=m.getTarget(c),g=c.data.clickPos||m.getClickPos(e,c),h=m.getValue(e,d.ref),i,j,k=c.data.container||d.ref.closest(".arcContainer");d.objID&&(f.setDocSelectedObject(k,d.ref[0].id),o.hasPendingUserinformation()||(j=$(e),x(j),o.setLastMouseDownPos(c),b.log("click f端r doc:"+d.docName+" and id: "+d.objID),o.doSendEvent(d.docName,d.objID,a.EID_CLICK,h,g.y,g.x,undefined,c.shiftKey,c.ctrlKey)))},m.onDocumentClick=function(a){var b;a.eventPase===Event.AT_TARGET&&f.setDocSelectedObject(a.data.container,undefined),a.data.activationCallback&&a.data.getTopDocNameCallback&&(b=f.getDocName(a.data.container),b!==a.data.getTopDocNameCallback()&&a.data.activationCallback(b,a.data.container))},m.onChange=function(c){if(q(c,m.onChange))return;var d=r(c);b.log("Event change for doc: "+d.docName+" and id: "+d.objID),o.doSendEvent(d.docName,d.objID,a.EID_SWITCH,c.target.value)},m.onInput=function(c){var d=r(c),e=m.getTarget(c),g=m.getValue(e,d.ref),h=c.data.clickPos||m.getClickPos(e,c),i=c.keyCode;z(d.ref,i,c.shiftKey);if(c.data.ref&&f.getObjType(c.data.ref)==="CheckboxGroup"&&e&&e.tagName!=="INPUT")return!1;if(e.tagName==="TEXTAREA"&&g===c.data.ref.text())return b.log("Input canceled for doc: "+d.docName+" and id: "+d.objID),!1;b.log("Event Input for doc: "+d.docName+" and id: "+d.objID),t(c.data.target,g),o.doSendEvent(d.docName,d.objID,a.EID_INPUT,y(g),h.y,h.x,c.keyCode,c.shiftKey,c.ctrlKey)},m.onResize=function(a){h.onResize(),g.updateLayout(a.data.container,o),g.setDocSize(a.data.container,parseFloat($(window).width()),parseFloat($(window).height()))},m.onPopupFunction=function(a){var b=m.getTarget(a);h.handlePopupFunctionEvent(b)},m.onDrop=function(b){var c=r(b),d=m.getTarget(b),e=b.data.text,f=m.getClickPos(d,b);b.preventDefault(),n&&(n=!1,o.doSendEvent(c.docName,c.objID,a.EID_DROP,e,f.y+1,f.x+1))},m.onDragStart=function(a){var b=r(a),c="["+b.docName+";OBJ"+b.objID+"]";n=!0,a.data.setText(c)},m})