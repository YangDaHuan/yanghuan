require(["events/eventcallbacks","events/eventid","properties","popuphandler","browserfeatures","tablehtmlgenerator","tablekeyboardhandler","keycodes"],function(a,b,c,d,e,f,g,h){describe("eventcallbacks Test",function(){function k(a,b,d,e){return a&&a.tagName==="INPUT"&&a.type==="checkbox"&&(a.checked=!a.checked),{data:{id:c.getID(b)||"Cont9_test",ref:b,objType:b?c.getObjType(b):null},target:a,shiftKey:d||!1,ctrlKey:e||!1,preventDefault:function(){},stopImmediatePropagation:function(){}}}var f,g,h,i,j;beforeEach(function(){f=this,$("<div></div>",{id:"arcContainer","class":"arcContainer"}).appendTo("body"),$('<div id="Cont8_test" class="objContainer"><div style="position:relative;"><div><table id="t0"><tr><td id="c0_0"><input id="i_0" type="CHECKBOX"></td></tr><tr><td id="c0_1"><input id="i_1" type="CHECKBOX" checked></td></tr><tr><td id="c0_2"><input id="i_2" type="CHECKBOX"></td></tr><tr><td id="c0_3"><nobr id="nbr1">Karl<nobr></td></tr><tr><td id="c0_4"><img id="i_4"/></td></tr></table></div></div></div>').appendTo("#arcContainer"),this.objRef=$("#Cont8_test"),c.setID(this.objRef,8),c.setDocName(this.objRef,"test"),c.setObjType(this.objRef,"Table"),c.setRowHeight(this.objRef,18),$("#t0 tr").css("height","18px"),$("#t0 input").css("margin","0"),$('<div id=\'Cont9_test\'><div><div><div><div id=\'h1\' class="arcHier"><ul><li id="1_1_1_A_LI"><input type="checkbox" id="1_1_1_A" checked="checked"/><label for="1_1_1_A"><span class="SPAN_1_1"></label>\r\n<ul><li id="2_2_1_B1_LI"><a id="2_2_1_B1">Child1</a>\r\n</li><li id="3_2_1_B2_LI"><a id="3_2_1_B2">Child2</a>\r\n</li></ul></li></ul></div></div></div></div></div>').appendTo("#arcContainer"),this.objRef=$("#Cont9_test"),c.setID(this.objRef,9),c.setDocName(this.objRef,"test"),c.setObjType(this.objRef,"VerticalHierarchie"),this.requestObj={doSendEvent:jasmine.createSpy("doSendEvent"),setLastMouseDownPos:jasmine.createSpy("setLastMouseDownPos"),hasPendingUserinformation:jasmine.createSpy("hasPendingUserinformation")},a.setRequestProcessor(this.requestObj),j=jasmine.createSpyObj("eventSetterSpy",["executePendingBlurEvent","setPendingEvent"]),a.setEventSetter(j)}),afterEach(function(){$("#arcContainer").remove(),c.resetAllProperties()}),it("should check a Switch with clickOnSwitch",function(){var d=$('<div id="Cont9_test"><button></button></div>').appendTo("#arcContainer");c.setYSettingValue(d,"0"),c.setDocName(d,"test"),c.setID(d,9),a.clickOnSwitch(k($("button",d)[0],d)),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",9,b.EID_SWITCH,1)}),it("should get the value from a checkbox",function(){expect(a.getValue($("#i_0")[0])).toEqual("0"),expect(a.getValue($("#i_1")[0])).toEqual("1"),expect(a.getValue($("#c0_1")[0])).toEqual('"null"')}),it("should get the value from a text input",function(){var b=$('<input type="text" id="arcTextInput" value="foo"></input>').appendTo("#arcContainer");expect(a.getValue(b[0])).toEqual("foo")}),it("should get the position from a checkbox",function(){var b=document.getElementById("i_1"),c={offsetX:0,offsetY:0,target:b};expect(a.getClickPos(c.target,c)).toEqual({x:0,y:1})}),it("should get the target from a cell",function(){var b=document.getElementById("nbr1"),c=document.getElementById("c0_3"),d={offsetX:0,offsetY:0,target:b};expect(a.getTarget(d)).toEqual(c)}),it("should send text input to the server",function(){var d=$('<div id="Cont7_test"><div><div><input type="text" value="foo|bar"></input></div><div><div>').appendTo("#arcContainer"),e=k($("input",d)[0],d);c.setDocName(d,"test"),c.setID(d,7),c.setObjType(d,"Field"),e.data.clickPos={x:0,y:1},a.onInput(e),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",7,b.EID_INPUT,"foo||bar",1,0,g,!1,!1)}),it("should send click events to the server",function(){var d=$('<div id="Cont7_test"><div><div><button><div></div></button></div></div></div>').appendTo("#arcContainer");c.setDocName(d,"test"),c.setID(d,7),a.onClick(k($("button",d)[0],d)),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",7,b.EID_CLICK,"",0,0,g,!1,!1)}),it("should not send click events to the server when userInformation is pending",function(){var b=$('<div id="Cont7_test"><div><div><button><div></div></button></div></div></div>').appendTo("#arcContainer");c.setDocName(b,"test"),c.setID(b,7),this.requestObj.hasPendingUserinformation=jasmine.createSpy().andReturn(!0),a.onClick(k($("button",b)[0],b)),expect(this.requestObj.doSendEvent).not.toHaveBeenCalled()}),it("should send switch events to the server",function(){var d=$('<div id="Cont7_test"><div><div><select><item checked = "true"></select></div></div></div>').appendTo("#arcContainer");c.setDocName(d,"test"),c.setID(d,7),a.onChange(k($("select",d)[0],d)),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",7,b.EID_SWITCH,"")}),it("should send switch events to the server on menu click",function(){var b,d="";d+='<div id="Cont14_test">',d+='<div class="dynaMenu">',d+='<div class="arcPopupContent arcHierPopupContent">',d+="<ul>",d+='   <li class="arcMenuItem" value="1">',d+='      <div class="arcMenuSelectionDiv">',d+='         <input type="checkbox" checked="checked">',d+="      </div>",d+='      <div class="arcMenuItemText">All Media</div>',d+="   </li>",d+="</ul>",d+="</div>",d+="</div>",d+="</div>",b=$(d).appendTo("#arcContainer"),c.setDocName(b,"test"),c.setID(b,14),a.onMenuClick(k($("#Cont14_test").find("li").first(),b)),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",14,1,1)}),it("should send close/open node event to the server",function(){var c=$("#Cont9_test"),d=$("#1_1_1_A");a.onHierClick(k(d[0],c,!1,!1)),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",9,b.EID_CLOSENODE,1,1,1,g,h,i),a.onHierClick(k(d[0],c,!1,!1)),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",9,b.EID_OPENNODE,1,1,1,g,h,i)}),it("should send select node event to the server",function(){var c=$("#Cont9_test"),d=$("#3_2_1_B2");a.onHierClick(k(d[0],c,!0,!1)),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",9,b.EID_SELECTNODE,3,1,2,g,h,i)}),it("should send select node with ctrl pressed event to the server",function(){var c=$("#Cont9_test"),d=$("#3_2_1_B2");a.onHierClick(k(d[0],c,!1,!0)),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",9,b.EID_SELECTNODE,3,1,2,g,h,i)}),it("should send switch hierpopup  event to the server",function(){var e=$("#Cont9_test"),f=$("#3_2_1_B2"),j;c.setObjType(e,"MenuHierarchie"),$("div.arcHier",e).addClass("arcHierPopupSelection"),d.showByRect(e,!1,{left:0,top:0,width:100,height:100}),j=k(f[0],e,!0,!1),j.data.id="Cont9_test",a.onHierClick(j),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",9,b.EID_SWITCH_HIERPOPUP,"3",undefined,undefined,g,h,i)}),it("should send click event in a Hier Popup",function(){var b;$('<div class="arcHierPopup" style="width:100px;height:20px;"></div>').appendTo("#arcContainer"),b=$(".arcHierPopup"),spyOn(d,"handlePopupEvent"),a.onHierClick(k(b[0],b)),expect(d.handlePopupEvent).toHaveBeenCalled()}),it("should send selectnode event in a Hierarchie",function(){var c,d,e;c=$("#Cont9_test"),d=$("li:first",c),e=k(d[0],c,!1,!1),e.offsetX=5,a.onHierMouseDown(e),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",9,b.EID_SELECTNODE,1,1,1,g,!1,!1)}),it("should select the right node on click the span-element in a Hierarchie",function(){var c,d,e;c=$("#Cont9_test"),d=$("li span:first",c),e=k(d[0],c,!1,!1),e.offsetX=5,a.onHierMouseDown(e),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",9,b.EID_SELECTNODE,1,1,1,g,!1,!1)}),it("should send the dropped object reference to the server",function(){var d,e,f="[test;OBJ10]";$('<div id="Cont10_test"></div>').appendTo("#arcContainer"),e=$("#Cont10_test"),c.setDocName(e,"test"),c.setID(e,10),d=k(e[0],e),d.data.setText=jasmine.createSpy("setText"),a.onDragStart(d),d.data.text=f,a.onDrop(d),expect(this.requestObj.doSendEvent).toHaveBeenCalledWith("test",10,b.EID_DROP,f,0,0)}),it("should set the drag event data to the dragged object reference",function(){var b,d,e="[test;OBJ11]";$('<div id="Cont11_test"></div>').appendTo("#arcContainer"),d=$("#Cont11_test"),c.setDocName(d,"test"),c.setID(d,11),b=k(d[0],d),b.data.setText=jasmine.createSpy("setText").andReturn(e),a.onDragStart(b),expect(b.data.setText).toHaveBeenCalledWith(e)}),it("should transfer the Event to the parent Node for images",function(){var b=document.getElementById("i_4"),c=$("#Cont8_test"),d={offsetX:0,offsetY:0,target:b,data:{ref:c}},e;e=a.getTarget(d),expect(e.tagName).toEqual("TD")}),it("should set the highlight style for button click events",function(){var b=$('<div id="Cont7_test"><div><div><button><span></span></button></div></div></div>').appendTo("#arcContainer"),d=$("span",b);c.setDocName(b,"test"),c.setID(b,7),a.onClick(k(d[0],b)),expect(d.parent().hasClass("arcClicked")).toEqual(!0)}),it("should not set the highlight style for checkbox click events",function(){var b=$("#Cont8_test"),d=$("input",b);c.setDocName(b,"test"),c.setID(b,8),a.onClick(k(d[0],b)),e.mobile?expect(d.hasClass("arcClicked")).toEqual(!1):expect(d.hasClass("arcClicked")).toEqual(!0)}),it("should set Click-Event as pendingEvent if a pending BlurEvent exists",function(){var b=$("#Cont8_test"),c=k(b[0],b),d=!1;a.setEventSetter({executePendingBlurEvent:function(){return!0},setPendingEvent:function(a){d=!0,expect(a.callback.toString()).toContain("onClick"),expect(a.event).toBeDefined()}}),a.onClick(c),expect(this.requestObj.doSendEvent).not.toHaveBeenCalled(),expect(d).toEqual(!0)}),it("should process normal Click-Event if no pending BlurEvent exists",function(){var b=$("#Cont8_test"),c=k(b[0],b),d=!1;a.setEventSetter({executePendingBlurEvent:function(){return!1},setPendingEvent:function(){d=!0}}),a.onClick(c),expect(this.requestObj.doSendEvent).toHaveBeenCalled(),expect(d).toEqual(!1)}),it("should set Menu Click-Event as pendingEvent if a pending BlurEvent exists",function(){var b=$("#Cont8_test"),c=k(b[0],b),d=!1;spyOn(a,"getTarget"),a.setEventSetter({executePendingBlurEvent:function(){return!0},setPendingEvent:function(a){d=!0,expect(a.callback.toString()).toContain("onMenuClick"),expect(a.event).toBeDefined()}}),a.onMenuClick(c),expect(a.getTarget).not.toHaveBeenCalled(),expect(d).toEqual(!0)}),it("should process normal Menu Click-Event if no pending BlurEvent exists",function(){var b=$("#Cont8_test"),c=k(b[0],b),d=!1;spyOn(a,"getTarget"),a.setEventSetter({executePendingBlurEvent:function(){return!1},setPendingEvent:function(){d=!0}}),a.onMenuClick(c),expect(a.getTarget).toHaveBeenCalled(),expect(d).toEqual(!1)}),it("should set Switch Click-Event as pendingEvent if a pending BlurEvent exists",function(){var b=$("#Cont8_test"),c=k(b[0],b),d=!1;a.setEventSetter({executePendingBlurEvent:function(){return!0},setPendingEvent:function(a){d=!0,expect(a.callback.toString()).toContain("clickOnSwitch"),expect(a.event).toBeDefined()}}),a.clickOnSwitch(c),expect(this.requestObj.doSendEvent).not.toHaveBeenCalled(),expect(d).toEqual(!0)}),it("should set Switch Click-Event as pendingEvent if a pending BlurEvent exists",function(){var b=$("#Cont8_test"),c=k(b[0],b),d=!1;a.setEventSetter({executePendingBlurEvent:function(){return!1},setPendingEvent:function(){d=!0}}),a.clickOnSwitch(c),expect(this.requestObj.doSendEvent).toHaveBeenCalled(),expect(d).toEqual(!1)})}),describe("eventcallbacks for table keyboard input",function(){function b(a,b,d,e){return{data:{id:c.getID(b)||"Cont9_test",ref:b},target:a,shiftKey:d,ctrlKey:e,preventDefault:function(){},stopImmediatePropagation:function(){}}}beforeEach(function(){$('<div id="arcContainer"></div>').appendTo("body"),$("body").css("margin","0px"),this.docContainer=$('<div id="Cont0_test"></div>').appendTo("#arcContainer"),this.obj=$('<div id="testObj"></div>').appendTo(this.docContainer),this.borderProp={top:!0,left:!1,right:!1,bottom:!1,type:"1Point",color:"#10AA10"},this.font={fontFamily:"Arial",fontSize:"10pt",fontStyle:"normal",fontWeight:"normal",textDecoration:"none"},c.setFont(this.obj,this.font),c.setBorder(this.obj,this.borderProp),c.setXPos(this.obj,111),c.setYPos(this.obj,42),c.setWidth(this.obj,200),c.setHeight(this.obj,100),c.setObjType(this.obj,"Table"),c.setVisible(this.obj,!0),f.generateTableStub(this.obj)}),afterEach(function(){$("#arcContainer").remove(),c.resetAllProperties()}),it("should relay keypress events to the tablekeyboardhandler",function(){var c=b(this.obj.children(":first"),this.obj);c.type="keypress",spyOn(g,"handleKeyPressEvent"),a.onTableKeyPress(c),expect(g.handleKeyPressEvent).toHaveBeenCalled()}),it("should relay keydown events for the DownArrow key to the tablekeyboardhandler",function(){var c=b(this.obj.children(":first"),this.obj);c.type="keydown",c.keyCode=h.DownArrow,spyOn(g,"handleKeyPressEvent"),a.onTableKeyDown(c),expect(g.handleKeyPressEvent).toHaveBeenCalled()}),it("should relay keydown events for the UpArrow key to the tablekeyboardhandler",function(){var c=b(this.obj.children(":first"),this.obj);c.type="keydown",c.keyCode=h.UpArrow,spyOn(g,"handleKeyPressEvent"),a.onTableKeyDown(c),expect(g.handleKeyPressEvent).toHaveBeenCalled()}),it("should relay keydown events for tab Key to the tablekeyboardhandler",function(){var c=b(this.obj.children(":first"),this.obj);c.type="keydown",c.keyCode=h.Tab,spyOn(g,"handleKeyPressEvent"),a.onTableKeyDown(c),expect(g.handleKeyPressEvent).toHaveBeenCalled()})}),describe("public onButtonClickCallback function",function(){it("should call requestProcessor.doSendRequest with the passed parameters",function(){var c=jasmine.createSpyObj("requestObjSpy",["doSendEvent","hasPendingUserinformation"]);a.setRequestProcessor(c),a.onButtonClickCallback("textDocName","1",!0,!1),expect(c.doSendEvent).toHaveBeenCalledWith("textDocName","1",b.EID_CLICK,jasmine.any(String),jasmine.any(Number),jasmine.any(Number),undefined,!0,!1),a.onButtonClickCallback("textDocName","2",!1,!0),expect(c.doSendEvent).toHaveBeenCalledWith("textDocName","2",b.EID_CLICK,jasmine.any(String),jasmine.any(Number),jasmine.any(Number),undefined,!1,!0)}),it("should not call requestProcessor.doSendRequest if there is a pending user information",function(){var b=jasmine.createSpyObj("requestObjSpy",["doSendEvent","hasPendingUserinformation"]);b.hasPendingUserinformation.andReturn(!0),a.setRequestProcessor(b),a.onButtonClickCallback("textDocName","1",!0,!1),expect(b.doSendEvent).not.toHaveBeenCalled()})})})